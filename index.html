<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é€±æœ«æŠ—æ‡¶æ•£ V4.0</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { margin: 0; padding: 0; font-family: "SF Pro TC", "Microsoft JhengHei", sans-serif; background: #f0f2f5; overflow: hidden; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        .top-bar {
            position: absolute; top: 0; left: 0; width: 100%; padding: 15px 20px;
            background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0) 100%);
            z-index: 1000; pointer-events: none; text-align: center;
        }
        .app-title { font-size: 1.1rem; font-weight: 900; color: #333; text-shadow: 0 2px 4px rgba(255,255,255,0.8); letter-spacing: 1px; }

        .bottom-panel {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(255, 255, 255, 0.98); border-radius: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 2000; padding: 20px; box-sizing: border-box;
            backdrop-filter: blur(10px); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .mode-switch-container {
            background: #f0f2f5; border-radius: 16px; padding: 5px;
            display: flex; margin-bottom: 20px; position: relative;
        }
        .mode-option {
            flex: 1; text-align: center; padding: 12px; font-size: 0.95rem; font-weight: bold; color: #888;
            cursor: pointer; z-index: 2; transition: color 0.3s;
        }
        .mode-option.active { color: #333; }
        .mode-slider {
            position: absolute; top: 5px; left: 5px; width: calc(50% - 5px); height: calc(100% - 10px);
            background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1); z-index: 1;
        }

        .main-btn {
            width: 100%; padding: 18px; border: none; border-radius: 18px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white; font-size: 1.1rem; font-weight: 800;
            box-shadow: 0 8px 20px rgba(56, 239, 125, 0.3);
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: transform 0.1s;
        }
        .main-btn:active { transform: scale(0.98); }
        .main-btn.event-mode {
            background: linear-gradient(135deg, #8e44ad 0%, #ff7675 100%);
            box-shadow: 0 8px 20px rgba(142, 68, 173, 0.3);
        }

        #result-area { display: none; margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px; }
        
        .res-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .res-tag { background: #e0f2f1; color: #009688; padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; }
        .res-tag.event { background: #f3e5f5; color: #8e44ad; }
        
        .res-title { font-size: 1.3rem; font-weight: 800; color: #2c3e50; margin-bottom: 8px; line-height: 1.3; }
        .res-desc { 
            font-size: 0.95rem; color: #555; line-height: 1.6; margin-bottom: 20px; 
            background: #f8f9fa; padding: 15px; border-radius: 12px; border-left: 4px solid #38ef7d;
        }
        .res-desc.event { border-left-color: #8e44ad; }

        .action-row { display: flex; gap: 10px; }
        .btn-link {
            flex: 1; background: #11998e; color: white; text-decoration: none;
            padding: 12px; border-radius: 12px; font-weight: bold; text-align: center;
            display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.95rem;
        }
        .btn-link.event { background: #8e44ad; }
        .btn-retry {
            width: 45px; background: #f0f0f0; color: #555; border: none;
            border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        .locate-btn {
            position: absolute; bottom: 20px; right: 20px;
            width: 45px; height: 45px; background: white; border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 1500; color: #333;
        }
        .bottom-panel.expanded ~ .locate-btn { bottom: 350px; transition: bottom 0.3s; }

        .loading-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.8); z-index: 3000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #38ef7d; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text" style="margin-top:15px; font-weight:bold; color:#555;">æ­£åœ¨å®šä½ä¸­...</p>
    </div>

    <div class="top-bar">
        <div class="app-title">ğŸ‡¹ğŸ‡¼ é€±æœ«æŠ—æ‡¶æ•£ V4.0</div>
    </div>

    <div id="map"></div>

    <div class="locate-btn" onclick="getCurrentLocation()">
        <i class="fas fa-crosshairs"></i>
    </div>

    <div id="panel" class="bottom-panel">
        
        <div class="mode-switch-container">
            <div class="mode-slider" id="slider"></div>
            <div class="mode-option active" onclick="switchMode('normal', 0)">
                <i class="fas fa-tree"></i> å¤šå…ƒæ¢éšª
            </div>
            <div class="mode-option" onclick="switchMode('event', 100)">
                <i class="fas fa-calendar-alt"></i> æ´»å‹•/å±•è¦½
            </div>
        </div>

        <div id="start-area">
            <button id="main-btn" class="main-btn" onclick="startMission()">
                <i class="fas fa-random"></i> éš¨æ©Ÿç”Ÿæˆè¡Œç¨‹
            </button>
            <p id="hint-text" style="text-align:center; font-size:0.8rem; color:#999; margin-top:10px;">
                * åŒ…å«ï¼šå¤§å­¸ã€åœ–æ›¸é¤¨ã€æ­¥é“ã€æº«æ³‰ã€å¸‚å ´ã€å’–å•¡å»³
            </p>
        </div>

        <div id="result-area">
            <div class="res-header">
                <div class="res-tag" id="res-tag">é¡åˆ¥</div>
                <div style="font-size:0.8rem; color:#888;" id="res-dist">è·é›¢</div>
            </div>
            
            <div class="res-title" id="res-name">åœ°é»åç¨±</div>
            <div class="res-desc" id="res-desc">ä»»å‹™å…§å®¹</div>

            <div class="action-row">
                <button class="btn-retry" onclick="startMission()">
                    <i class="fas fa-redo"></i>
                </button>
                <a id="res-link" href="#" target="_blank" class="btn-link">
                    <i class="fas fa-location-arrow"></i> å°èˆªå‡ºç™¼
                </a>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map, userMarker, targetMarker, routeLine, rangeCircle;
        let currentLat, currentLng;
        let currentMode = 'normal';

        // --- å¤šå…ƒæ´»å‹•é¡åˆ¥å®šç¾© ---
        const activityThemes = [
            { id: "university", name: "ğŸ“ å¤§å­¸æ¼«æ­¥", query: 'node["amenity"="university"]', task: "å»æ ¡åœ’è£¡æ•£æ­¥ï¼Œæ‰¾æ‰¾çœ‹æœ‰æ²’æœ‰ä¾¿å®œçš„å­¸é¤æˆ–å¤§è‰çš®ã€‚" },
            { id: "library", name: "ğŸ“š éˆé­‚å……é›»", query: 'node["amenity"="library"]', task: "é€²å»åœ–æ›¸é¤¨ï¼Œéš¨æ©ŸæŠ½ä¸€æœ¬é›œèªŒæˆ–æ›¸ï¼Œåè‘—è®€ 20 åˆ†é˜ã€‚" },
            { id: "worship", name: "â›©ï¸ æ²‰æ¾±å¿ƒéˆ", query: 'node["amenity"="place_of_worship"]', task: "é€²å»æ„Ÿå—ä¸€ä¸‹å»ºç¯‰çš„å¯§éœï¼Œè§€å¯Ÿå±‹é ‚æˆ–çª—æˆ¶çš„ç´°ç¯€ã€‚" },
            { id: "nature", name: "ğŸŒ² è‡ªç„¶å‘¼å¸", query: '(node["leisure"="park"]; node["tourism"="viewpoint"];)', task: "æ‰¾åˆ°é€™å€‹åœ°æ–¹çš„æœ€é«˜é»æˆ–ä¸­å¿ƒé»ï¼Œæ·±å‘¼å¸ä¸‰æ¬¡ã€‚" },
            { id: "market", name: "ğŸ¥¬ å‚³çµ±å¸‚å ´", query: 'node["amenity"="marketplace"]', task: "èµ°é€²å»æ„Ÿå—åœ¨åœ°çš„æ´»åŠ›ï¼Œè²·ä¸€æ¨£ç•¶å­£æ°´æœã€‚" },
            { id: "cafe", name: "â˜• ç¨ç«‹å’–å•¡", query: 'node["amenity"="cafe"]', task: "é»ä¸€æ¯æ²’å–éçš„é£²æ–™ï¼Œä½”é ˜ä¸€å€‹è§’è½ç™¼å‘†ã€‚" }
        ];

        // é€£é–åº—é»‘åå–®
        const chainBlockList = ["Starbucks", "Louisa", "7-Eleven", "FamilyMart", "McDonald", "KFC", "PxMart", "Carrefour"];

        window.onload = function() {
            initMap();
            getCurrentLocation();
        };

        function initMap() {
            map = L.map('map', {zoomControl: false}).setView([25.0478, 121.5170], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: ''}).addTo(map);
        }

        function getCurrentLocation() {
            showLoading("å®šä½ä¸­...");
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        currentLat = pos.coords.latitude;
                        currentLng = pos.coords.longitude;
                        updateUserLocation(currentLat, currentLng);
                        hideLoading();
                    },
                    (err) => {
                        alert("å®šä½å¤±æ•—ï¼Œé è¨­å°åŒ—è»Šç«™");
                        currentLat = 25.0478; currentLng = 121.5170;
                        updateUserLocation(currentLat, currentLng);
                        hideLoading();
                    },
                    { enableHighAccuracy: true }
                );
            } else {
                hideLoading();
                alert("ç€è¦½å™¨ä¸æ”¯æ´å®šä½");
            }
        }

        function updateUserLocation(lat, lng) {
            if (userMarker) map.removeLayer(userMarker);
            userMarker = L.circleMarker([lat, lng], {
                radius: 8, fillColor: '#11998e', color: '#fff', weight: 3, fillOpacity: 1
            }).addTo(map);
            map.setView([lat, lng], 14);
        }

        window.switchMode = function(mode, offsetPercent) {
            currentMode = mode;
            document.getElementById('slider').style.transform = `translateX(${offsetPercent}%)`;
            const opts = document.querySelectorAll('.mode-option');
            opts.forEach(o => o.classList.remove('active'));
            if(mode === 'normal') opts[0].classList.add('active');
            else opts[1].classList.add('active');

            const btn = document.getElementById('main-btn');
            const hint = document.getElementById('hint-text');
            
            document.getElementById('result-area').style.display = 'none';
            document.getElementById('start-area').style.display = 'block';

            if (mode === 'normal') {
                btn.innerHTML = '<i class="fas fa-random"></i> éš¨æ©Ÿç”Ÿæˆè¡Œç¨‹';
                btn.className = 'main-btn';
                hint.innerText = "* åŒ…å«ï¼šå¤§å­¸ã€åœ–æ›¸é¤¨ã€æ­¥é“ã€æº«æ³‰ã€å¸‚å ´ã€å’–å•¡å»³";
            } else {
                btn.innerHTML = '<i class="fas fa-search"></i> æœå°‹æ–‡åŒ–éƒ¨è³‡æ–™';
                btn.className = 'main-btn event-mode';
                hint.innerText = "* å˜—è©¦æŠ“å–çœŸå¯¦å±•è¦½è³‡æ–™ï¼Œè‹¥ç„¡å‰‡æœå°‹å ´é¤¨";
            }
        }

        async function startMission() {
            if (!currentLat) { alert("è«‹å…ˆå®šä½"); return; }
            
            // éš¨æ©ŸåŠå¾‘ï¼š2km ~ 10km (ç¯„åœç¨å¾®æ‹‰å¤§ä¸€é»ï¼Œå› ç‚ºå¤§å­¸/å±•è¦½é¤¨æ¯”è¼ƒç¨€ç–)
            const radius = Math.floor(Math.random() * (10000 - 2000) + 2000);
            
            if (currentMode === 'normal') {
                // --- æ—¥å¸¸å¤šå…ƒæ¨¡å¼ ---
                showLoading("æ­£åœ¨å°‹æ‰¾æœ‰è¶£çš„è§’è½...");
                
                // 1. éš¨æ©ŸæŠ½é¸ä¸€å€‹ä¸»é¡Œ
                const theme = activityThemes[Math.floor(Math.random() * activityThemes.length)];
                
                // 2. æ§‹å»º Query
                const query = `
                    [out:json][timeout:15];
                    (
                      ${theme.query}(around:${radius},${currentLat},${currentLng});
                    );
                    out 20;
                `;
                
                fetchOSM(query, theme);

            } else {
                // --- æœŸé–“é™å®šæ¨¡å¼ (æ–‡åŒ–éƒ¨ API) ---
                showLoading("æ­£åœ¨é€£ç·šæ–‡åŒ–éƒ¨è³‡æ–™åº«...");
                fetchCultureData();
            }
        }

        // è™•ç† OSM è³‡æ–™ (æ—¥å¸¸æ¨¡å¼)
        async function fetchOSM(query, theme) {
            const url = "https://overpass-api.de/api/interpreter?data=" + encodeURIComponent(query);
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                let candidates = data.elements || [];
                
                // éæ¿¾é€£é–åº— (åªé‡å° Cafe)
                if (theme.id === 'cafe') {
                    candidates = candidates.filter(place => {
                        const name = place.tags.name || "";
                        return !chainBlockList.some(chain => name.includes(chain));
                    });
                }

                if (candidates.length === 0) {
                    // å¦‚æœé€™å€‹ä¸»é¡Œæ‰¾ä¸åˆ° (ä¾‹å¦‚é™„è¿‘æ²’å¤§å­¸)ï¼Œéè¿´é‡è©¦ä¸€æ¬¡ (æ›å€‹ä¸»é¡Œ)
                    // ç°¡å–®è™•ç†ï¼šç›´æ¥æ›æˆæ‰¾å…¬åœ’ (ä¿åº•)
                    if (theme.id !== 'nature') {
                        const fallbackTheme = activityThemes.find(t => t.id === 'nature');
                        const fallbackQuery = `[out:json][timeout:15];(${fallbackTheme.query}(around:5000,${currentLat},${currentLng}););out 20;`;
                        fetchOSM(fallbackQuery, fallbackTheme);
                        return;
                    } else {
                        alert("é™„è¿‘çœŸçš„å¤ªè’æ¶¼äº†...æ‰¾ä¸åˆ°é»");
                        hideLoading();
                        return;
                    }
                }

                const place = candidates[Math.floor(Math.random() * candidates.length)];
                generateResult(place, theme.name, theme.task);

            } catch (e) {
                console.error(e);
                alert("åœ°åœ–è³‡æ–™é€£ç·šå¤±æ•—");
                hideLoading();
            }
        }

        // è™•ç†æ–‡åŒ–éƒ¨ API (æ´»å‹•æ¨¡å¼)
        async function fetchCultureData() {
            // æ–‡åŒ–éƒ¨å±•è¦½è³‡è¨Š API (é¡åˆ¥6 = å±•è¦½)
            // ç”±æ–¼ API ä¸æ”¯æ´ç¶“ç·¯åº¦ç¯©é¸ï¼Œæˆ‘å€‘å¿…é ˆæŠ“ä¸‹ä¾†è‡ªå·±ç®—è·é›¢ (åªæŠ“å‰ 100 ç­†æˆ–ä½¿ç”¨å…¨éƒ¨)
            // å‚™è¨»ï¼šè‹¥ API å¤±æ•ˆï¼Œæœƒè‡ªå‹•é™ç´šç‚º OSM å ´é¤¨æœå°‹
            const apiUrl = "https://cloud.culture.tw/frontsite/trans/SearchShowAction.do?method=doFindTypeJ&category=6";
            
            try {
                const response = await fetch(apiUrl);
                const events = await response.json();
                
                // ç¯©é¸è·é›¢ (Client-side filtering)
                const nearbyEvents = events.filter(ev => {
                    //æœ‰äº›è³‡æ–™æ²’æœ‰ç¶“ç·¯åº¦
                    if (!ev.showInfo || !ev.showInfo[0].latitude) return false;
                    
                    const eLat = parseFloat(ev.showInfo[0].latitude);
                    const eLng = parseFloat(ev.showInfo[0].longitude);
                    
                    const dist = getDistanceFromLatLonInKm(currentLat, currentLng, eLat, eLng);
                    return dist <= 15; // æ‰¾ 15km å…§çš„æ´»å‹•
                });

                if (nearbyEvents.length > 0) {
                    // æ‰¾åˆ°æ´»å‹•äº†ï¼
                    const ev = nearbyEvents[Math.floor(Math.random() * nearbyEvents.length)];
                    const info = ev.showInfo[0];
                    const place = {
                        lat: parseFloat(info.latitude),
                        lon: parseFloat(info.longitude),
                        tags: { name: info.locationName } // ä½¿ç”¨å ´é¤¨å
                    };
                    
                    const taskName = ev.title;
                    const taskDesc = `æ­£åœ¨å±•å‡ºï¼š${ev.title}ã€‚<br>åœ°é»ï¼š${info.location}ã€‚<br>å»çœ‹çœ‹é€™å ´å±•è¦½å§ï¼`;
                    
                    generateResult(place, "ğŸ¨ çœŸå¯¦å±•è¦½", taskDesc, taskName);
                } else {
                    // æ²’æ‰¾åˆ°æ´»å‹• -> é™ç´šå» OSM æ‰¾åšç‰©é¤¨/é›»å½±é™¢
                    console.log("é™„è¿‘ç„¡æ–‡åŒ–éƒ¨æ´»å‹•ï¼Œé™ç´šæœå°‹å ´é¤¨");
                    const radius = 5000;
                    const fallbackQuery = `
                        [out:json][timeout:15];
                        (
                          node["amenity"~"cinema|theatre|arts_centre"](around:${radius},${currentLat},${currentLng});
                          node["tourism"~"museum|gallery"](around:${radius},${currentLat},${currentLng});
                        );
                        out 20;
                    `;
                    // é€™è£¡å¾©ç”¨ OSM çš„é‚è¼¯ï¼Œä½†ç‚ºäº†ç°¡åŒ–ä»£ç¢¼ï¼Œæˆ‘ç›´æ¥æ¨¡æ“¬ä¸€æ¬¡ fetchOSM
                    // å¯¦éš›å°ˆæ¡ˆå¯é‡æ§‹ï¼Œé€™è£¡ç›´æ¥å‘¼å«ï¼š
                    const theme = { name: "ğŸ›ï¸ è—æ–‡å ´é¤¨", task: "å»é€™è£¡çœ‹çœ‹æœ€è¿‘æœ‰ä»€éº¼æ´»å‹•æˆ–å±•è¦½ã€‚" };
                    fetchOSM(fallbackQuery, theme);
                }

            } catch (e) {
                console.error("æ–‡åŒ–éƒ¨ API å¤±æ•—", e);
                // å¤±æ•—ä¹Ÿé™ç´š
                const theme = { name: "ğŸ›ï¸ è—æ–‡å ´é¤¨", task: "å»é€™è£¡çœ‹çœ‹æœ€è¿‘æœ‰ä»€éº¼æ´»å‹•æˆ–å±•è¦½ã€‚" };
                const fallbackQuery = `[out:json];(node["tourism"="museum"](around:5000,${currentLat},${currentLng}););out 10;`;
                fetchOSM(fallbackQuery, theme);
            }
        }

        // è¼”åŠ©ï¼šè¨ˆç®—è·é›¢
        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
            var R = 6371; var dLat = deg2rad(lat2-lat1); var dLon = deg2rad(lon2-lon1); 
            var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c;
        }
        function deg2rad(deg) { return deg * (Math.PI/180) }

        function generateResult(place, type, desc, overrideName) {
            const tags = place.tags || {};
            const name = overrideName || tags.name || "æœªçŸ¥çš„åœ°é»";
            const lat = place.lat;
            const lon = place.lon;
            const dist = (map.distance([currentLat, currentLng], [lat, lon]) / 1000).toFixed(1);

            // æ›´æ–°åœ°åœ–
            if (targetMarker) map.removeLayer(targetMarker);
            if (routeLine) map.removeLayer(routeLine);
            if (rangeCircle) map.removeLayer(rangeCircle);

            const iconUrl = currentMode === 'normal' 
                ? 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png'
                : 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png';

            const icon = L.icon({
                iconUrl: iconUrl,
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
            });
            targetMarker = L.marker([lat, lon], {icon: icon}).addTo(map);

            const lineColor = currentMode === 'normal' ? '#11998e' : '#8e44ad';
            routeLine = L.polyline([[currentLat, currentLng], [lat, lon]], {
                color: lineColor, weight: 4, dashArray: '10, 10', opacity: 0.8
            }).addTo(map);
            map.fitBounds(routeLine.getBounds().pad(0.3));

            // æ›´æ–°é¢æ¿æ–‡å­—
            document.getElementById('res-tag').innerText = type;
            document.getElementById('res-tag').className = currentMode === 'normal' ? 'res-tag' : 'res-tag event';
            document.getElementById('res-dist').innerText = `è·é›¢ ${dist} km`;
            document.getElementById('res-name').innerText = name;
            document.getElementById('res-desc').innerHTML = desc; // æ”¯æ´ HTML æ›è¡Œ
            document.getElementById('res-desc').className = currentMode === 'normal' ? 'res-desc' : 'res-desc event';
            
            // å°èˆªé€£çµ
            const gmapUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}&travelmode=driving`;
            const btnLink = document.getElementById('res-link');
            btnLink.href = gmapUrl;
            btnLink.className = currentMode === 'normal' ? 'btn-link' : 'btn-link event';

            // å±•é–‹
            document.getElementById('start-area').style.display = 'none';
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('panel').classList.add('expanded');

            hideLoading();
        }

        function showLoading(text) {
            document.getElementById('loading-text').innerText = text;
            document.getElementById('loading').style.display = 'flex';
        }
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
    </script>
</body>
</html>
